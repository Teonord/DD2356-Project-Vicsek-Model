<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HPC Project Viscek Model for Flocking Birds: Project in DD2356: Vicsek Model for Flocking Birds</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HPC Project Viscek Model for Flocking Birds
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Project in DD2356: Vicsek Model for Flocking Birds </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README_doxygen"></a>Project (graded, 3.0 credits) in the course DD2356 Methods in High Performance Computing (7.5 credits). Project goal is to make a parallelized implementations of the Vicsek Model using OpenMP and MPI, and comparing these with a serial verison.</p>
<p>The implemented Vicsek model is on the form</p>
<p class="formulaDsp">
\[\mathbf{x}_i(t+\Delta t)=\mathbf{x}_i(t) + \mathbf{v}_i(t)\Delta t\]
</p>
<p>where the velocity </p><p class="formulaDsp">
\[\mathbf{v}_i(t)\]
</p>
<p> is of magnitude </p><p class="formulaDsp">
\[v_0\]
</p>
<p> and with angle </p><p class="formulaDsp">
\[\theta_i\]
</p>
<p> calculated through</p>
<p class="formulaDsp">
\[\theta_i(t + \Delta t) = \langle \theta(t)\rangle_r + \Delta \theta\]
</p>
<p>More information can be found in the Project Report.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Files</h1>
<ul>
<li><b><a class="el" href="proj__serial_8c.html">proj_serial.c</a></b><ul>
<li>Contains serial implementation of the Vicsek model.</li>
</ul>
</li>
<li><b><a class="el" href="proj__omp_8c.html">proj_omp.c</a></b><ul>
<li>Contains OpenMP threaded implementation of the Vicsek model.</li>
</ul>
</li>
<li><b><a class="el" href="proj__mpi_8c.html">proj_mpi.c</a></b><ul>
<li>Contains MPI implementation of the Vicsek model.</li>
</ul>
</li>
<li><b><a class="el" href="proj__mpi__omp_8c.html">proj_mpi_omp.c</a></b><ul>
<li>Contains MPI implementation of the Vicsek model with OpenMP threading capabilities.</li>
</ul>
</li>
<li><b><a class="el" href="proj__common_8h.html">proj_common.h</a></b><ul>
<li>Contains all functions and constants (parameters) neccessary to all of the different implementations of the Vicsek model.</li>
</ul>
</li>
<li><b><a class="el" href="proj__tests_8c.html">proj_tests.c</a></b><ul>
<li>Contains tests for all the functions defined in <a class="el" href="proj__common_8h.html">proj_common.h</a></li>
</ul>
</li>
<li><b><a class="el" href="plotter_8py.html">plotter.py</a></b><ul>
<li>Python Matplotlib Quiver plotter for the results from the C code.</li>
</ul>
</li>
<li><b><a class="el" href="verification__values_8py.html">verification_values.py</a></b><ul>
<li>Used to verify that all result values are the same when parameter VERIF is set to 1. Used to see that all of the different implementations of the code are consistent.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Running Locally</h1>
<p>This assumes you are running <b>Ubuntu</b> for local computer.</p>
<p>Clone the project</p>
<div class="fragment"><div class="line">git clone https://github.com/Teonord/DD2356-Project-Vicsek-Model</div>
</div><!-- fragment --><p>Go to the project directory</p>
<div class="fragment"><div class="line">cd DD2365-Project-Vicsek-Model</div>
</div><!-- fragment --><p>Change parameters like number of birds and timestep in <b><a class="el" href="proj__common_8h.html">proj_common.h</a></b></p>
<div class="fragment"><div class="line">emacs proj_common.h</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Non MPI Implementations</h2>
<p>Compile the files</p>
<div class="fragment"><div class="line">cc -o &lt;filename&gt;.out &lt;filename&gt;.c -fopenmp -lm</div>
</div><!-- fragment --><p>Set amount of OpenMP threads (if needed)</p>
<div class="fragment"><div class="line">export OMP_NUM_THREADS=&lt;threads&gt;</div>
</div><!-- fragment --><p>Run code</p>
<div class="fragment"><div class="line">./&lt;filename&gt;.out &gt; res</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
For MPI Implementations</h2>
<p>Install MPICH</p>
<div class="fragment"><div class="line">sudo apt install mpich</div>
</div><!-- fragment --><p>Compile the files</p>
<div class="fragment"><div class="line">mpicc -o &lt;filename&gt;.out &lt;filename&gt;.c -fopenmp -lm</div>
</div><!-- fragment --><p>Set amount of OpenMP threads (if needed)</p>
<div class="fragment"><div class="line">export OMP_NUM_THREADS=&lt;threads&gt;</div>
</div><!-- fragment --><p>Run code with number of processes</p>
<div class="fragment"><div class="line">mpiexec -n &lt;processes&gt; ./&lt;filename&gt;.out &gt; res</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md5"></a>
Running on Dardel</h1>
<p>Follow guide in Running Locally to download and set up code.</p>
<p>Copy code to Dardel</p>
<div class="fragment"><div class="line">scp &lt;DD2365-Project-Vicsek-Model&gt; &lt;username&gt;@dardel.pdc.kth.se:Private/.</div>
</div><!-- fragment --><p>After entering Dardel and moving to proper folder, compile code.</p>
<div class="fragment"><div class="line">cc -o &lt;filename&gt;.out &lt;filename&gt;.c -fopenmp -lm</div>
</div><!-- fragment --><p>Create Job Script for running code.</p>
<div class="fragment"><div class="line">touch &lt;filename&gt;.sh</div>
<div class="line">emacs &lt;filename&gt;.sh</div>
</div><!-- fragment --><p>Enter information neccessary for your batched run of the code.</p>
<div class="fragment"><div class="line">#!/bin/bash -l</div>
<div class="line"> </div>
<div class="line">#SBATCH -A &lt;allocation_code&gt;</div>
<div class="line"> </div>
<div class="line">#SBATCH -J &lt;filename&gt;</div>
<div class="line"> </div>
<div class="line">#SBATCH -p main</div>
<div class="line"> </div>
<div class="line">#SBATCH -n &lt;n&gt;</div>
<div class="line"> </div>
<div class="line">#SBATCH --nodes=&lt;n&gt;</div>
<div class="line"> </div>
<div class="line">#SBATCH --ntasks-per-node=&lt;n&gt;</div>
<div class="line"> </div>
<div class="line">#SBATCH --cpus-per-task=&lt;n&gt;</div>
<div class="line"> </div>
<div class="line">#SBATCH -t 00:05:00</div>
<div class="line"> </div>
<div class="line">export OMP_NUM_THREADS=&lt;threads&gt;</div>
<div class="line">export OMP_PLACES=cores</div>
<div class="line"> </div>
<div class="line">srun ./&lt;filename&gt;.out &gt; ./Results/res_&lt;filename&gt;</div>
</div><!-- fragment --><p>Save and exit using Ctrl-x, Ctrl-c, y, Enter.</p>
<p>Run the batched Job and wait for run to be completed.</p>
<div class="fragment"><div class="line">sbatch &lt;filename&gt;.sh</div>
</div><!-- fragment --><p>To check progress, you can check the queue.</p>
<div class="fragment"><div class="line">squeue -u &lt;username&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
Visualization</h1>
<p>This assumes that you have at least Python 3 installed</p>
<p>To visualize the code, take the results file and place it next to the <a class="el" href="plotter_8py.html">plotter.py</a> file. Change the "filename" variable to the name of the results file.</p>
<p>Install neccessary modules</p>
<div class="fragment"><div class="line">pip install matplotlib numpy</div>
</div><!-- fragment --><p>Run code</p>
<div class="fragment"><div class="line">python ./plotter.py</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md7"></a>
Testing</h1>
<p>There are two tests of the code.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Unit Testing</h2>
<p>To run unit testing of the code, follow the <a href="#run-locally">Run Locally</a> section to compile the <b><a class="el" href="proj__tests_8c.html">proj_tests.c</a></b> file</p>
<p>Run the file</p>
<div class="fragment"><div class="line">./proj_tests.out</div>
</div><!-- fragment --><p>If output is all zeroes, code has passed the tests. If non-zero, look through the code to see what test hasn't been passed. Make sure that VERIF in <b>proj_commons.h</b> is set to 0 when running unit testing.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Result Verification</h2>
<p>To run result verification, first set VERIF to 1 in <b>proj_commons.h</b>. Do not change any other parameters. This will disable randomness and create a deterministic setup and effects for all functions. Next, follow <a href="#run-locally">Run Locally</a> to run the <b><a class="el" href="proj__serial_8c.html">proj_serial.c</a></b> code and at least one other file you wish to verify. Put the resulting files in the folder with <b><a class="el" href="verification__values_8py.html">verification_values.py</a></b>. Open <b><a class="el" href="verification__values_8py.html">verification_values.py</a></b> and set "filename1" and "filename2" to the names of the result files.</p>
<p>Install neccessary modules</p>
<div class="fragment"><div class="line">pip install numpy</div>
</div><!-- fragment --><p>Run code</p>
<div class="fragment"><div class="line">python ./verification_values.py</div>
</div><!-- fragment --><p>Output should have one line with text. An otherwise empty file means verification was passed. Any more lines means something was problematic. If so, make sure that VERIF is set to 1. </p>
<h1><a class="anchor" id="autotoc_md10"></a>
Authors</h1>
<ul>
<li><a href="https://www.github.com/Teonord">@Teonord</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
